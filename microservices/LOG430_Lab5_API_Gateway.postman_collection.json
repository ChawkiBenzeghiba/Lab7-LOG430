{
  "info": {
    "name": "LOG430 Lab5 - API Gateway",
    "description": "Collection Postman pour tester l'API Gateway avec load balancing et sécurité CORS",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "clientId",
      "value": "1",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Gateway",
      "item": [
        {
          "name": "Informations Gateway",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            },
            "description": "Récupère les informations de l'API Gateway, services disponibles et configuration load balancing"
          }
        },
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": ["{{baseUrl}}"],
              "path": ["health"]
            },
            "description": "Vérifie l'état de santé de l'API Gateway"
          }
        },
        {
          "name": "Test CORS",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Origin",
                "value": "http://localhost:8080",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/cors-test",
              "host": ["{{baseUrl}}"],
              "path": ["cors-test"]
            },
            "description": "Test de la configuration CORS"
          }
        }
      ]
    },
    {
      "name": "Produits",
      "item": [
        {
          "name": "Récupérer tous les produits",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/produits",
              "host": ["{{baseUrl}}"],
              "path": ["api", "produits"]
            },
            "description": "Récupère la liste de tous les produits"
          }
        },
        {
          "name": "Récupérer un produit par ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/produits/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "produits", "1"]
            },
            "description": "Récupère un produit spécifique par son ID"
          }
        },
        {
          "name": "Créer un nouveau produit",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Nouveau Produit\",\n  \"description\": \"Description du nouveau produit\",\n  \"prix\": 99.99,\n  \"categorie\": \"Électronique\",\n  \"codeProduit\": \"NEW-PROD-001\",\n  \"quantiteStock\": 10\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/produits",
              "host": ["{{baseUrl}}"],
              "path": ["api", "produits"]
            },
            "description": "Crée un nouveau produit"
          }
        }
      ]
    },
    {
      "name": "Panier (Load Balancing)",
      "item": [
        {
          "name": "Récupérer le panier d'un client",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/panier/client/{{clientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "panier", "client", "{{clientId}}"]
            },
            "description": "Récupère le contenu du panier d'un client (avec load balancing round-robin)"
          }
        },
        {
          "name": "Ajouter un produit au panier",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"produitId\": 1,\n  \"quantite\": 2,\n  \"prixUnitaire\": 1199.99\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/panier/client/{{clientId}}/ajouter",
              "host": ["{{baseUrl}}"],
              "path": ["api", "panier", "client", "{{clientId}}", "ajouter"]
            },
            "description": "Ajoute un produit au panier (avec load balancing et vérification stock)"
          }
        },
        {
          "name": "Vider le panier",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/panier/client/{{clientId}}/vider",
              "host": ["{{baseUrl}}"],
              "path": ["api", "panier", "client", "{{clientId}}", "vider"]
            },
            "description": "Vide le panier d'un client"
          }
        }
      ]
    },
    {
      "name": "Commandes",
      "item": [
        {
          "name": "Récupérer les commandes d'un client",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/commandes/client/{{clientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "commandes", "client", "{{clientId}}"]
            },
            "description": "Récupère l'historique des commandes d'un client"
          }
        },
        {
          "name": "Valider une commande",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    {\n      \"produitId\": 1,\n      \"quantite\": 2,\n      \"prixUnitaire\": 1199.99\n    },\n    {\n      \"produitId\": 5,\n      \"quantite\": 1,\n      \"prixUnitaire\": 399.99\n    }\n  ],\n  \"adresseLivraison\": \"123 Rue de la Démo, Montréal, QC\",\n  \"adresseFacturation\": \"123 Rue de la Démo, Montréal, QC\",\n  \"methodePaiement\": \"carte_credit\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/commandes/client/{{clientId}}/valider",
              "host": ["{{baseUrl}}"],
              "path": ["api", "commandes", "client", "{{clientId}}", "valider"]
            },
            "description": "Valide le panier en créant une commande (vide automatiquement le panier)"
          }
        }
      ]
    },
    {
      "name": "Stock",
      "item": [
        {
          "name": "Récupérer l'état du stock central",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/stock/stock-central",
              "host": ["{{baseUrl}}"],
              "path": ["api", "stock", "stock-central"]
            },
            "description": "Récupère l'inventaire complet du stock central"
          }
        }
      ]
    },
    {
      "name": "Tests CORS",
      "item": [
        {
          "name": "Test CORS - Origine autorisée",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Origin",
                "value": "http://localhost:8080",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/cors-test",
              "host": ["{{baseUrl}}"],
              "path": ["cors-test"]
            },
            "description": "Test CORS avec une origine autorisée"
          }
        },
        {
          "name": "Test CORS - Origine non autorisée",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Origin",
                "value": "http://malicious-site.com",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/cors-test",
              "host": ["{{baseUrl}}"],
              "path": ["cors-test"]
            },
            "description": "Test CORS avec une origine non autorisée (doit être rejetée)"
          }
        },
        {
          "name": "Test CORS - Preflight OPTIONS",
          "request": {
            "method": "OPTIONS",
            "header": [
              {
                "key": "Origin",
                "value": "http://localhost:8080",
                "type": "text"
              },
              {
                "key": "Access-Control-Request-Method",
                "value": "POST",
                "type": "text"
              },
              {
                "key": "Access-Control-Request-Headers",
                "value": "Content-Type",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/produits",
              "host": ["{{baseUrl}}"],
              "path": ["api", "produits"]
            },
            "description": "Test de la requête preflight OPTIONS"
          }
        }
      ]
    },
    {
      "name": "Tests Load Balancing",
      "item": [
        {
          "name": "Test Load Balancing - 10 requêtes",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test de load balancing avec 10 requêtes",
                  "for (let i = 0; i < 10; i++) {",
                  "  pm.sendRequest({",
                  "    url: pm.variables.get('baseUrl') + '/api/panier/client/' + pm.variables.get('clientId'),",
                  "    method: 'GET'",
                  "  }, function (err, response) {",
                  "    console.log('Requête ' + (i + 1) + ': ' + response.status);",
                  "  });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/panier/client/{{clientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "panier", "client", "{{clientId}}"]
            },
            "description": "Test de distribution de charge avec 10 requêtes consécutives"
          }
        }
      ]
    }
  ]
} 